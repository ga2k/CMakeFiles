# CMake package configuration (installed)
@PACKAGE_INIT@

include(CMakeFindDependencyMacro)

# Resolve installed library path (cover common layouts)
set(_lib "${PACKAGE_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/@CMAKE_SHARED_LIBRARY_PREFIX@@APP_VENDOR_LC@_@APP_NAME_LC@@CMAKE_SHARED_LIBRARY_SUFFIX@")
if(NOT EXISTS "${_lib}")
  message(FATAL_ERROR "@APP_VENDOR@::@APP_NAME@ library not found under ${PACKAGE_PREFIX_DIR}")
endif()

if (DATABASE IN LISTS @APP_FEATURES@)
  find_dependency(SOCI REQUIRED)
endif()

if (SSL IN LISTS @APP_FEATURES@)
  find_dependency(OpenSSL REQUIRED)
endif()

#if(NOT TARGET @APP_VENDOR@::@APP_NAME@)
#  add_library(@APP_VENDOR@::@APP_NAME@ SHARED IMPORTED)
#  set_target_properties(@APP_VENDOR@::@APP_NAME@ PROPERTIES
#    IMPORTED_LOCATION "${_lib}"
#    CXX_STANDARD 23
#    INTERFACE_INCLUDE_DIRECTORIES "${PACKAGE_PREFIX_DIR}/include"
#  )
#endif()
#include("${PACKAGE_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/cmake/cxx/@APP_VENDOR@/cxx-modules-@APP_NAME@Target.cmake")

include("${PACKAGE_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/cmake/@APP_NAME@Target.cmake")

# For Clang consumers of modules, provide prebuilt-module path automatically
if(CMAKE_CXX_COMPILER_ID MATCHES "Clang")
  target_compile_options(@APP_VENDOR@::@APP_NAME@ INTERFACE
    "-fprebuilt-module-path=${PACKAGE_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/cmake/bmi/@APP_VENDOR@/@APP_NAME@"
  )
endif()
  
# For GCC, you may need similar flags
if(CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
  target_compile_options(@APP_VENDOR@::@APP_NAME@ INTERFACE
    "-fmodule-mapper=${PACKAGE_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/cmake/bmi/@APP_VENDOR@/@APP_NAME@"
  )
endif()

# Convenience variables
set(@APP_NAME@_INCLUDE_DIR  "${PACKAGE_PREFIX_DIR}/include")
set(@APP_NAME@_INCLUDE_DIR  "${PACKAGE_PREFIX_DIR}/include" PARENT_SCOPE)
set(@APP_NAME@_INCLUDE_DIRS "${PACKAGE_PREFIX_DIR}/include")
set(@APP_NAME@_INCLUDE_DIRS "${PACKAGE_PREFIX_DIR}/include" PARENT_SCOPE)
set(@APP_NAME@_LIBRARIES    @APP_VENDOR@::@APP_NAME@)
set(@APP_NAME@_LIBRARIES    @APP_VENDOR@::@APP_NAME@ PARENT_SCOPE)

# Plugin and resource directories

if (NOT "@APP_CREATES_PLUGINS@" STREQUAL "")
  # If the app creates plugins, set the plugin directory
  set(@APP_VENDOR@_PLUGIN_DIR "${PACKAGE_PREFIX_DIR}/lib64/@APP_VENDOR@/@APP_NAME@/plugins")
  set(@APP_VENDOR@_PLUGIN_DIR "${PACKAGE_PREFIX_DIR}/lib64/@APP_VENDOR@/@APP_NAME@/plugins" PARENT_SCOPE)
endif()

if (NOT "@APP_SUPPLIES_RESOURCES@" STREQUAL "")
  # If the app supplies resources, set the resource directory
  set(@APP_NAME@_RESOURCE_DIR "${PACKAGE_PREFIX_DIR}/share/@APP_VENDOR@/@APP_NAME@/resources")
  set(@APP_NAME@_RESOURCE_DIR "${PACKAGE_PREFIX_DIR}/share/@APP_VENDOR@/@APP_NAME@/resources" PARENT_SCOPE)
elseif (NOT "@APP_INCLUDES_RESOURCES@" STREQUAL "")
  # If the app consumes resources, set the resource directory
  set(@APP_NAME@_RESOURCE_DIR "${PACKAGE_PREFIX_DIR}/share/@APP_VENDOR@/@APP_NAME@/resources")
  set(@APP_NAME@_RESOURCE_DIR "${PACKAGE_PREFIX_DIR}/share/@APP_VENDOR@/@APP_NAME@/resources" PARENT_SCOPE)
endif()
